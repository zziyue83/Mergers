  0%|          | 0/4 [00:00<?, ?it/s]sys:1: DtypeWarning: Columns (18,22,30,36,38) have mixed types. Specify dtype option on import or set low_memory=False.
GenerateDemandEstimationData.py:174: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: http://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  year_data[characteristic] = year_data['upc'].map(features_map[characteristic])
 25%|██▌       | 1/4 [00:03<00:09,  3.05s/it] 50%|█████     | 2/4 [00:06<00:06,  3.27s/it]sys:1: DtypeWarning: Columns (18,22,24,28,30,36,38) have mixed types. Specify dtype option on import or set low_memory=False.
 75%|███████▌  | 3/4 [00:10<00:03,  3.53s/it]sys:1: DtypeWarning: Columns (22,30) have mixed types. Specify dtype option on import or set low_memory=False.
100%|██████████| 4/4 [00:15<00:00,  3.76s/it]100%|██████████| 4/4 [00:15<00:00,  3.82s/it]
(1721493, 38)
Index(['Unnamed: 0', 'upc', 'dma_code', 'month', 'volume', 'price',
       'size1_amount', 'size1_units', 'brand_descr', 'owner initial',
       'owner last', 'y-m-d', 'year', '# month', 'market_size',
       'market_size_DMA', 'market_share', 'postmerger', 'month_since_start',
       'involved', 'involvedpostmerger', 'product-region', 'time', 'cpiu',
       'price_index', 'adjusted_price', 'log_adjusted_price',
       'hhinc_per_person_mean', 'hhinc_per_person_median', 'employment_rate',
       'adjusted_hhinc_per_person_mean', 'log_adjusted_hhinc_per_person_mean',
       'log_employment_rate', 'product', 'upc_dma_code', 'distance', 'y-m',
       'style_descr'],
      dtype='object')
        time     wheat        t
0   7/1/1959  1.954636  1959-07
1   8/3/1959  1.958810  1959-08
2   9/1/1959  1.962905  1959-09
3  10/1/1959  1.981318  1959-10
4  11/2/1959  2.005690  1959-11
       time  barley        t
0  4/1/2000   76.95  2000-04
1  5/1/2000   78.26  2000-05
2  6/1/2000   78.48  2000-06
3  7/1/2000   78.68  2000-07
4  8/1/2000   75.13  2000-08
             y-m  postmerger
0        2006-01           0
1        2006-01           0
2        2006-01           0
3        2006-01           0
4        2006-01           0
...          ...         ...
1721488  2008-04           0
1721489  2008-04           0
1721490  2008-04           0
1721491  2008-04           0
1721492  2008-04           0

[1721493 rows x 2 columns]
             y-m  postmerger
0        2006-01           0
1        2006-01           0
2        2006-01           0
3        2006-01           0
4        2006-01           0
...          ...         ...
1721488  2008-04           0
1721489  2008-04           0
1721490  2008-04           0
1721491  2008-04           0
1721492  2008-04           0

[1721493 rows x 2 columns]
0          500200601
1          501200601
2          502200601
3          503200601
4          504200601
             ...    
1721488    616200804
1721489    679200804
1721490    717200804
1721491    753200804
1721492    758200804
Name: dma_code_month, Length: 1721493, dtype: object
['dma_code_month', 'adjusted_price', 'market_share', 'month_since_start', 'upc', 'dma_code', 'owner initial', 'brand_descr', 'style_descr', 'wheat', 'barley']
  dma_code_month  adjusted_price  ...     wheat      barley
0      500200601        0.134551  ...  4.356919  134.774562
1      501200601        0.127685  ...  4.356919  134.774562
2      502200601        0.113288  ...  4.356919  134.774562
3      503200601        0.109541  ...  4.356919  134.774562
4      504200601        0.129549  ...  4.356919  134.774562

[5 rows x 11 columns]
  market_ids    prices  ...  demand_instruments0  demand_instruments1
0  500200601  0.134551  ...             4.356919           134.774562
1  501200601  0.127685  ...             4.356919           134.774562
2  502200601  0.113288  ...             4.356919           134.774562
3  503200601  0.109541  ...             4.356919           134.774562
4  504200601  0.129549  ...             4.356919           134.774562

[5 rows x 11 columns]
0          500200601
1          501200601
2          502200601
3          503200601
4          504200601
             ...    
1721488    616200804
1721489    679200804
1721490    717200804
1721491    753200804
1721492    758200804
Name: market_ids, Length: 1721493, dtype: object
Initializing the problem ...
Absorbing demand-side fixed effects ...
Initialized the problem after 00:00:32.

Dimensions:
====================================
 T       N      F    K1    MD    ED 
----  -------  ---  ----  ----  ----
6058  1721493  28    2     3     2  
====================================

Formulations:
========================================
     Column Indices:          0      1  
--------------------------  ------  ----
X1: Linear Characteristics  prices  time
========================================
Dimensions:
====================================
 T       N      F    K1    MD    ED 
----  -------  ---  ----  ----  ----
6058  1721493  28    2     3     2  
====================================

Formulations:
========================================
     Column Indices:          0      1  
--------------------------  ------  ----
X1: Linear Characteristics  prices  time
========================================
Solving the problem ...
Updating the weighting matrix ...
Computed results after 00:00:02.

Problem Results Summary:
=====================================
GMM     Objective    Weighting Matrix
Step      Value      Condition Number
----  -------------  ----------------
 1    +4.104775E+02   +1.756184E+03  
=====================================

Estimating standard errors ...
Computed results after 00:00:01.

Problem Results Summary:
========================================================
GMM     Objective    Weighting Matrix  Covariance Matrix
Step      Value      Condition Number  Condition Number 
----  -------------  ----------------  -----------------
 2    +2.287668E+01   +1.623682E+03      +1.762947E+09  
========================================================

Cumulative Statistics:
========================
Computation   Objective 
   Time      Evaluations
-----------  -----------
 00:00:03         2     
========================

Beta Estimates (Robust SEs in Parentheses):
================================
    prices            time      
---------------  ---------------
 -4.101302E+02    -1.609112E-02 
(+1.574484E+01)  (+1.285957E-03)
================================
Problem Results Summary:
========================================================
GMM     Objective    Weighting Matrix  Covariance Matrix
Step      Value      Condition Number  Condition Number 
----  -------------  ----------------  -----------------
 2    +2.287668E+01   +1.623682E+03      +1.762947E+09  
========================================================

Cumulative Statistics:
========================
Computation   Objective 
   Time      Evaluations
-----------  -----------
 00:00:03         2     
========================

Beta Estimates (Robust SEs in Parentheses):
================================
    prices            time      
---------------  ---------------
 -4.101302E+02    -1.609112E-02 
(+1.574484E+01)  (+1.285957E-03)
================================
Initializing the problem ...
Absorbing demand-side fixed effects ...
Initialized the problem after 00:00:45.

Dimensions:
=========================================
 T       N      F    K1    MD    ED    H 
----  -------  ---  ----  ----  ----  ---
6058  1721493  28    2     3     3     1 
=========================================

Formulations:
========================================
     Column Indices:          0      1  
--------------------------  ------  ----
X1: Linear Characteristics  prices  time
========================================
Solving the problem ...

Rho Initial Values:
=============
 All Groups  
-------------
+7.000000E-01
=============

Rho Lower Bounds:
=============
 All Groups  
-------------
+0.000000E+00
=============

Rho Upper Bounds:
=============
 All Groups  
-------------
+9.900000E-01
=============

Starting optimization ...

GMM   Optimization   Objective   Fixed Point  Contraction    Objective      Objective      Projected                 
Step   Iterations   Evaluations  Iterations   Evaluations      Value       Improvement   Gradient Norm      Theta    
----  ------------  -----------  -----------  -----------  -------------  -------------  -------------  -------------
 1         0             1            0            0       +2.405354E-05                 +1.072994E+01  +7.000000E-01
 1         0             2            0            0       +2.672692E-04                 +0.000000E+00  +0.000000E+00
 1         0             3            0            0       +3.769726E-05                 +1.343268E+01  +6.244352E-01
 1         0             4            0            0       +2.643735E-05                 +1.124908E+01  +6.854858E-01
 1         0             5            0            0       +2.453859E-05                 +1.083759E+01  +6.969904E-01
 1         0             6            0            0       +2.415523E-05                 +1.075260E+01  +6.993665E-01
 1         0             7            0            0       +2.407499E-05                 +1.073473E+01  +6.998662E-01
 1         0             8            0            0       +2.405807E-05                 +1.073095E+01  +6.999717E-01
 1         0             9            0            0       +2.405450E-05                 +1.073016E+01  +6.999940E-01
 1         0            10            0            0       +2.405374E-05                 +1.072999E+01  +6.999987E-01
 1         0            11            0            0       +2.405358E-05                 +1.072995E+01  +6.999997E-01
 1         0            12            0            0       +2.405355E-05                 +1.072995E+01  +6.999999E-01
 1         0            13            0            0       +2.405354E-05                 +1.072994E+01  +7.000000E-01
 1         0            14            0            0       +2.405354E-05                 +1.072994E+01  +7.000000E-01
 1         0            15            0            0       +2.405354E-05                 +1.072994E+01  +7.000000E-01
 1         0            16            0            0       +2.405354E-05                 +1.072994E+01  +7.000000E-01
 1         0            17            0            0       +2.405354E-05                 +1.072994E+01  +7.000000E-01
 1         0            18            0            0       +2.405354E-05  +9.705427E-13  +1.072994E+01  +7.000000E-01
 1         0            19            0            0       +2.405354E-05                 +1.072994E+01  +7.000000E-01
 1         0            20            0            0       +2.405354E-05                 +1.072994E+01  +7.000000E-01
 1         0            21            0            0       +2.405354E-05                 +1.072994E+01  +7.000000E-01

The optimization routine failed to converge. This problem can sometimes be mitigated by choosing more reasonable initial parameter values, setting more conservative bounds, or configuring other optimization settings.


Optimization failed after 00:15:25.
Computing the Hessian and and updating the weighting matrix ...
Computed results after 00:02:14.

Problem Results Summary:
===================================================================
GMM     Objective      Projected       Reduced     Weighting Matrix
Step      Value      Gradient Norm     Hessian     Condition Number
----  -------------  -------------  -------------  ----------------
 1    +2.405354E-05  +1.072994E+01  -3.157937E+01   +2.186318E+08  
===================================================================

Starting optimization ...

GMM   Optimization   Objective   Fixed Point  Contraction    Objective      Objective      Projected                 
Step   Iterations   Evaluations  Iterations   Evaluations      Value       Improvement   Gradient Norm      Theta    
----  ------------  -----------  -----------  -----------  -------------  -------------  -------------  -------------
 2         0             1            0            0       +8.350133E-05                 +3.724876E+01  +7.000000E-01
 2         0             2            0            0       +9.278190E-04                 +0.000000E+00  +0.000000E+00
 2         0             3            0            0       +1.308652E-04                 +4.663127E+01  +6.244352E-01
 2         0             4            0            0       +9.177668E-05                 +3.905092E+01  +6.854858E-01
 2         0             5            0            0       +8.518515E-05                 +3.762245E+01  +6.969904E-01
 2         0             6            0            0       +8.385436E-05                 +3.732742E+01  +6.993665E-01
 2         0             7            0            0       +8.357580E-05                 +3.726537E+01  +6.998662E-01
 2         0             8            0            0       +8.351706E-05                 +3.725227E+01  +6.999717E-01
 2         0             9            0            0       +8.350465E-05                 +3.724950E+01  +6.999940E-01
 2         0            10            0            0       +8.350204E-05                 +3.724892E+01  +6.999987E-01
 2         0            11            0            0       +8.350148E-05                 +3.724880E+01  +6.999997E-01
 2         0            12            0            0       +8.350136E-05                 +3.724877E+01  +6.999999E-01
 2         0            13            0            0       +8.350133E-05                 +3.724876E+01  +7.000000E-01
 2         0            14            0            0       +8.350133E-05  +2.868555E-14  +3.724876E+01  +7.000000E-01
 2         0            15            0            0       +8.350133E-05                 +3.724876E+01  +7.000000E-01
 2         0            16            0            0       +8.350133E-05  +1.486309E-12  +3.724876E+01  +7.000000E-01
 2         0            17            0            0       +8.350133E-05  +1.806747E-12  +3.724876E+01  +7.000000E-01
 2         0            18            0            0       +8.350133E-05                 +3.724876E+01  +7.000000E-01
 2         0            19            0            0       +8.350133E-05                 +3.724876E+01  +7.000000E-01
 2         0            20            0            0       +8.350133E-05                 +3.724876E+01  +7.000000E-01
 2         0            21            0            0       +8.350133E-05                 +3.724876E+01  +7.000000E-01
 2         1            22            0            0       +9.278190E-04                 +0.000000E+00  +0.000000E+00
 2         1            23            0            0       +1.308652E-04                 +4.663127E+01  +6.244352E-01
 2         1            24            0            0       +9.177668E-05                 +3.905092E+01  +6.854858E-01
 2         1            25            0            0       +8.518515E-05                 +3.762245E+01  +6.969904E-01
 2         1            26            0            0       +8.385435E-05                 +3.732742E+01  +6.993665E-01
 2         1            27            0            0       +8.357581E-05                 +3.726537E+01  +6.998662E-01
 2         1            28            0            0       +8.351706E-05                 +3.725227E+01  +6.999717E-01
 2         1            29            0            0       +8.350466E-05                 +3.724951E+01  +6.999940E-01
 2         1            30            0            0       +8.350203E-05                 +3.724892E+01  +6.999987E-01
 2         1            31            0            0       +8.350148E-05                 +3.724880E+01  +6.999997E-01
 2         1            32            0            0       +8.350136E-05                 +3.724877E+01  +6.999999E-01
 2         1            33            0            0       +8.350134E-05                 +3.724876E+01  +7.000000E-01
 2         1            34            0            0       +8.350134E-05                 +3.724876E+01  +7.000000E-01
 2         1            35            0            0       +8.350133E-05                 +3.724876E+01  +7.000000E-01
 2         1            36            0            0       +8.350133E-05                 +3.724876E+01  +7.000000E-01
 2         1            37            0            0       +8.350133E-05                 +3.724876E+01  +7.000000E-01
 2         1            38            0            0       +8.350133E-05                 +3.724876E+01  +7.000000E-01
 2         1            39            0            0       +8.350133E-05                 +3.724876E+01  +7.000000E-01
 2         1            40            0            0       +8.350133E-05                 +3.724876E+01  +7.000000E-01
 2         1            41            0            0       +8.350133E-05                 +3.724876E+01  +7.000000E-01

The optimization routine failed to converge. This problem can sometimes be mitigated by choosing more reasonable initial parameter values, setting more conservative bounds, or configuring other optimization settings.


Optimization failed after 00:30:00.
Computing the Hessian and estimating standard errors ...
Computed results after 00:02:11.

Problem Results Summary:
======================================================================================
GMM     Objective      Projected       Reduced     Weighting Matrix  Covariance Matrix
Step      Value      Gradient Norm     Hessian     Condition Number  Condition Number 
----  -------------  -------------  -------------  ----------------  -----------------
 2    +8.350133E-05  +3.724876E+01  -1.582651E+02   +2.082175E+08      +7.437534E+24  
======================================================================================

Cumulative Statistics:
======================================
Computation  Optimization   Objective 
   Time       Iterations   Evaluations
-----------  ------------  -----------
 00:49:49         1            64     
======================================

Rho Estimates (Robust SEs in Parentheses):
===============
  All Groups   
---------------
 +7.000000E-01 
(+4.248206E-04)
===============

Beta Estimates (Robust SEs in Parentheses):
================================
    prices            time      
---------------  ---------------
 -1.947518E+01    -3.432545E+02 
(+1.363172E+03)  (+4.573480E-02)
================================
Problem Results Summary:
======================================================================================
GMM     Objective      Projected       Reduced     Weighting Matrix  Covariance Matrix
Step      Value      Gradient Norm     Hessian     Condition Number  Condition Number 
----  -------------  -------------  -------------  ----------------  -----------------
 2    +8.350133E-05  +3.724876E+01  -1.582651E+02   +2.082175E+08      +7.437534E+24  
======================================================================================

Cumulative Statistics:
======================================
Computation  Optimization   Objective 
   Time       Iterations   Evaluations
-----------  ------------  -----------
 00:49:49         1            64     
======================================

Rho Estimates (Robust SEs in Parentheses):
===============
  All Groups   
---------------
 +7.000000E-01 
(+4.248206E-04)
===============

Beta Estimates (Robust SEs in Parentheses):
================================
    prices            time      
---------------  ---------------
 -1.947518E+01    -3.432545E+02 
(+1.363172E+03)  (+4.573480E-02)
================================
