  0%|          | 0/4 [00:00<?, ?it/s]sys:1: DtypeWarning: Columns (18,22,30,36,38) have mixed types. Specify dtype option on import or set low_memory=False.
GenerateDemandEstimationData.py:107: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: http://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  year_data[characteristic] = year_data['upc'].map(features_map[characteristic])
 25%|██▌       | 1/4 [00:03<00:11,  3.84s/it] 50%|█████     | 2/4 [00:08<00:08,  4.03s/it]sys:1: DtypeWarning: Columns (18,22,24,28,30,36,38) have mixed types. Specify dtype option on import or set low_memory=False.
 75%|███████▌  | 3/4 [00:13<00:04,  4.23s/it]sys:1: DtypeWarning: Columns (22,30) have mixed types. Specify dtype option on import or set low_memory=False.
100%|██████████| 4/4 [00:18<00:00,  4.47s/it]100%|██████████| 4/4 [00:18<00:00,  4.51s/it]
['2007' '2008' '2009' '2006']
(2895907, 38)
Index(['Unnamed: 0', 'upc', 'dma_code', 'month', 'volume', 'price',
       'size1_amount', 'size1_units', 'brand_descr', 'owner initial',
       'owner last', 'y-m-d', 'year', '# month', 'market_size',
       'market_size_DMA', 'market_share', 'postmerger', 'month_since_start',
       'involved', 'involvedpostmerger', 'product-region', 'time', 'cpiu',
       'price_index', 'adjusted_price', 'log_adjusted_price',
       'hhinc_per_person_mean', 'hhinc_per_person_median', 'employment_rate',
       'adjusted_hhinc_per_person_mean', 'log_adjusted_hhinc_per_person_mean',
       'log_employment_rate', 'product', 'upc_dma_code', 'distance', 'y-m',
       'style_descr'],
      dtype='object')
0    2180702
1     715205
Name: style_descr, dtype: int64
        time     wheat        t
0   7/1/1959  1.954636  1959-07
1   8/3/1959  1.958810  1959-08
2   9/1/1959  1.962905  1959-09
3  10/1/1959  1.981318  1959-10
4  11/2/1959  2.005690  1959-11
       time  barley        t
0  4/1/2000   76.95  2000-04
1  5/1/2000   78.26  2000-05
2  6/1/2000   78.48  2000-06
3  7/1/2000   78.68  2000-07
4  8/1/2000   75.13  2000-08
['dma_code_month', 'adjusted_price', 'upc', 'market_share', 'distance', 'y-m', 'style_descr', 'wheat', 'barley']
  dma_code_month  adjusted_price        upc  ...  style_descr     wheat      barley
0      500200601        0.134551  948700007  ...            1  4.356919  134.774562
1      501200601        0.127685  948700007  ...            1  4.356919  134.774562
2      502200601        0.113288  948700007  ...            1  4.356919  134.774562
3      503200601        0.109541  948700007  ...            1  4.356919  134.774562
4      504200601        0.129549  948700007  ...            1  4.356919  134.774562

[5 rows x 9 columns]
  market_ids    prices  ...  demand_instruments1  demand_instruments2
0  500200601  0.134551  ...             4.356919           134.774562
1  501200601  0.127685  ...             4.356919           134.774562
2  502200601  0.113288  ...             4.356919           134.774562
3  503200601  0.109541  ...             4.356919           134.774562
4  504200601  0.129549  ...             4.356919           134.774562

[5 rows x 9 columns]
Initializing the problem ...
Absorbing demand-side fixed effects ...
Initialized the problem after 00:02:25.

Dimensions:
===============================
 T       N      K1    MD    ED 
----  -------  ----  ----  ----
9721  2895907   2     4     2  
===============================

Formulations:
===============================================
     Column Indices:          0          1     
--------------------------  ------  -----------
X1: Linear Characteristics  prices  style_descr
===============================================
Dimensions:
===============================
 T       N      K1    MD    ED 
----  -------  ----  ----  ----
9721  2895907   2     4     2  
===============================

Formulations:
===============================================
     Column Indices:          0          1     
--------------------------  ------  -----------
X1: Linear Characteristics  prices  style_descr
===============================================
Solving the problem ...
Updating the weighting matrix ...
Computed results after 00:00:03.

Problem Results Summary:
=====================================
GMM     Objective    Weighting Matrix
Step      Value      Condition Number
----  -------------  ----------------
 1    +3.714880E-04   +3.037176E+33  
=====================================

Estimating standard errors ...
Computed results after 00:00:02.

Problem Results Summary:
========================================================
GMM     Objective    Weighting Matrix  Covariance Matrix
Step      Value      Condition Number  Condition Number 
----  -------------  ----------------  -----------------
 2    +3.060495E-27   +3.151570E+26      +2.447784E+02  
========================================================

Cumulative Statistics:
========================
Computation   Objective 
   Time      Evaluations
-----------  -----------
 00:00:05         2     
========================

Beta Estimates (Robust SEs in Parentheses):
================================
    prices         style_descr  
---------------  ---------------
 -1.715520E+01    -2.726456E-02 
(+1.639644E+00)  (+1.056417E-01)
================================
Problem Results Summary:
========================================================
GMM     Objective    Weighting Matrix  Covariance Matrix
Step      Value      Condition Number  Condition Number 
----  -------------  ----------------  -----------------
 2    +3.060495E-27   +3.151570E+26      +2.447784E+02  
========================================================

Cumulative Statistics:
========================
Computation   Objective 
   Time      Evaluations
-----------  -----------
 00:00:05         2     
========================

Beta Estimates (Robust SEs in Parentheses):
================================
    prices         style_descr  
---------------  ---------------
 -1.715520E+01    -2.726456E-02 
(+1.639644E+00)  (+1.056417E-01)
================================
Initializing the problem ...
Absorbing demand-side fixed effects ...
Initialized the problem after 00:02:26.

Dimensions:
====================================
 T       N      K1    MD    ED    H 
----  -------  ----  ----  ----  ---
9721  2895907   1     4     2     1 
====================================

Formulations:
==================================
     Column Indices:          0   
--------------------------  ------
X1: Linear Characteristics  prices
==================================
Solving the problem ...

Rho Initial Values:
=============
 All Groups  
-------------
+7.000000E-01
=============

Rho Lower Bounds:
=============
 All Groups  
-------------
+0.000000E+00
=============

Rho Upper Bounds:
=============
 All Groups  
-------------
+9.900000E-01
=============

Starting optimization ...

GMM   Optimization   Objective   Fixed Point  Contraction    Objective      Objective      Projected                 
Step   Iterations   Evaluations  Iterations   Evaluations      Value       Improvement   Gradient Norm      Theta    
----  ------------  -----------  -----------  -----------  -------------  -------------  -------------  -------------
 1         0             1            0            0       +1.693317E+02                 +1.253371E+04  +7.000000E-01
 1         0             2            0            0       +7.788543E+04                 +2.746852E+05  +0.000000E+00
 1         0             3            0            0       +2.334734E+01  +1.459844E+02  +5.006686E+03  +6.572512E-01
 1         1             4            0            0       +1.176630E-01  +2.322968E+01  +2.842364E-06  +6.694533E-01
 1         2             5            0            0       +1.176630E-01  +1.369975E-09  +4.350729E-07  +6.694533E-01
 1         3             6            0            0       +1.176630E-01  +1.888436E-10  +1.016698E-06  +6.694533E-01
 1         3             7            0            0       +1.176630E-01  +6.276533E-10  +2.089643E-06  +6.694533E-01
 1         3             8            0            0       +1.176630E-01                 +1.763741E-06  +6.694533E-01
 1         3             9            0            0       +1.176630E-01                 +2.089643E-06  +6.694533E-01
 1         3            10            0            0       +1.176630E-01                 +9.336846E-07  +6.694533E-01
 1         3            11            0            0       +1.176630E-01                 +2.089643E-06  +6.694533E-01
 1         3            12            0            0       +1.176630E-01                 +1.659477E-06  +6.694533E-01
 1         3            13            0            0       +1.176630E-01                 +2.089643E-06  +6.694533E-01
 1         3            14            0            0       +1.176630E-01                 +1.831630E-06  +6.694533E-01
 1         3            15            0            0       +1.176630E-01                 +2.089643E-06  +6.694533E-01
 1         4            16            0            0       +1.176630E-01                 +1.332553E-06  +6.694533E-01
 1         4            17            0            0       +1.176630E-01                 +2.089643E-06  +6.694533E-01
 1         4            18            0            0       +1.176630E-01  +2.719169E-11  +2.044239E-06  +6.694533E-01
 1         4            19            0            0       +1.176630E-01  +1.502648E-10  +2.398467E-06  +6.694533E-01
 1         4            20            0            0       +1.176630E-01                 +2.130830E-06  +6.694533E-01
 1         4            21            0            0       +1.176630E-01                 +2.398467E-06  +6.694533E-01
 1         4            22            0            0       +1.176630E-01                 +2.015997E-06  +6.694533E-01
 1         4            23            0            0       +1.176630E-01                 +2.398467E-06  +6.694533E-01
 1         5            24            0            0       +1.176630E-01                 +3.360151E-06  +6.694533E-01
 1         5            25            0            0       +1.176630E-01                 +2.398467E-06  +6.694533E-01
 1         5            26            0            0       +1.176630E-01                 +2.297612E-06  +6.694533E-01
 1         5            27            0            0       +1.176630E-01                 +2.398467E-06  +6.694533E-01
 1         5            28            0            0       +1.176630E-01                 +1.099185E-06  +6.694533E-01
 1         5            29            0            0       +1.176630E-01                 +2.398467E-06  +6.694533E-01
 1         5            30            0            0       +1.176630E-01                 +1.303527E-06  +6.694533E-01
 1         5            31            0            0       +1.176630E-01                 +2.398467E-06  +6.694533E-01
 1         5            32            0            0       +1.176630E-01                 +1.388881E-06  +6.694533E-01
 1         5            33            0            0       +1.176630E-01                 +2.398467E-06  +6.694533E-01
 1         5            34            0            0       +1.176630E-01  +2.438324E-10  +3.059187E-06  +6.694533E-01
 1         5            35            0            0       +1.176630E-01                 +2.315418E-06  +6.694533E-01
 1         5            36            0            0       +1.176630E-01                 +3.059187E-06  +6.694533E-01
 1         5            37            0            0       +1.171343E-01  +5.286847E-04  +9.841174E-01  +6.694509E-01
 1         5            38            0            0       +1.176630E-01                 +4.429202E-06  +6.694533E-01
 1         5            39            0            0       +1.171347E-01                 +9.833881E-01  +6.694509E-01
 1         5            40            0            0       +1.171343E-01                 +9.841174E-01  +6.694509E-01
 1         6            41            0            0       +1.176630E-01                 +4.429202E-06  +6.694533E-01
 1         6            42            0            0       +1.171347E-01                 +9.833881E-01  +6.694509E-01
 1         6            43            0            0       +1.171343E-01                 +9.841304E-01  +6.694509E-01
 1         6            44            0            0       +1.171343E-01                 +9.841174E-01  +6.694509E-01
 1         6            45            0            0       +1.171343E-01  +4.659727E-11  +9.841172E-01  +6.694509E-01
 1         6            46            0            0       +1.171343E-01                 +9.841186E-01  +6.694509E-01
 1         6            47            0            0       +1.171343E-01                 +9.841174E-01  +6.694509E-01
 1         6            48            0            0       +1.171343E-01                 +9.841172E-01  +6.694509E-01
 1         6            49            0            0       +1.171343E-01                 +9.841174E-01  +6.694509E-01
 1         6            50            0            0       +1.171343E-01                 +9.841172E-01  +6.694509E-01
 1         6            51            0            0       +1.171343E-01                 +9.841174E-01  +6.694509E-01
 1         6            52            0            0       +1.171343E-01                 +9.841172E-01  +6.694509E-01
 1         7            53            0            0       +1.171346E-01                 +9.836202E-01  +6.694509E-01
 1         7            54            0            0       +1.171343E-01                 +9.841191E-01  +6.694509E-01
 1         7            55            0            0       +1.171343E-01                 +9.841174E-01  +6.694509E-01
 1         7            56            0            0       +1.171343E-01                 +9.841172E-01  +6.694509E-01
 1         7            57            0            0       +1.171343E-01                 +9.841174E-01  +6.694509E-01
 1         7            58            0            0       +1.171343E-01                 +9.841172E-01  +6.694509E-01
 1         7            59            0            0       +1.171343E-01                 +9.841174E-01  +6.694509E-01
 1         7            60            0            0       +1.171343E-01                 +9.841172E-01  +6.694509E-01

Optimization completed after 01:25:16.
Computing the Hessian and and updating the weighting matrix ...
Computed results after 00:04:18.

Problem Results Summary:
===================================================================
GMM     Objective      Projected       Reduced     Weighting Matrix
Step      Value      Gradient Norm     Hessian     Condition Number
----  -------------  -------------  -------------  ----------------
 1    +1.171343E-01  +9.841172E-01  +4.098179E+05   +2.289522E+41  
===================================================================

Starting optimization ...

GMM   Optimization   Objective   Fixed Point  Contraction    Objective      Objective      Projected                 
Step   Iterations   Evaluations  Iterations   Evaluations      Value       Improvement   Gradient Norm      Theta    
----  ------------  -----------  -----------  -----------  -------------  -------------  -------------  -------------
 2         0             1            0            0       +1.288977E-01                 +4.070533E+02  +6.694509E-01
 2         0             2            0            0       +1.437517E+05                 +4.298681E+05  +0.000000E+00
 2         0             3            0            0       +4.334888E-24  +1.288977E-01  +2.408220E-09  +6.688176E-01

Optimization completed after 00:04:15.
Computing the Hessian and estimating standard errors ...
Computed results after 00:04:15.

Problem Results Summary:
======================================================================================
GMM     Objective      Projected       Reduced     Weighting Matrix  Covariance Matrix
Step      Value      Gradient Norm     Hessian     Condition Number  Condition Number 
----  -------------  -------------  -------------  ----------------  -----------------
 2    +4.334888E-24  +2.408220E-09  +6.427287E+05   +8.919431E+31      +1.338634E+05  
======================================================================================

Cumulative Statistics:
======================================
Computation  Optimization   Objective 
   Time       Iterations   Evaluations
-----------  ------------  -----------
 01:38:03         9            65     
======================================

Rho Estimates (Robust SEs in Parentheses):
===============
  All Groups   
---------------
 +6.688176E-01 
(+1.765532E-03)
===============

Beta Estimates (Robust SEs in Parentheses):
===============
    prices     
---------------
 -6.976445E+00 
(+6.132251E-01)
===============
Problem Results Summary:
======================================================================================
GMM     Objective      Projected       Reduced     Weighting Matrix  Covariance Matrix
Step      Value      Gradient Norm     Hessian     Condition Number  Condition Number 
----  -------------  -------------  -------------  ----------------  -----------------
 2    +4.334888E-24  +2.408220E-09  +6.427287E+05   +8.919431E+31      +1.338634E+05  
======================================================================================

Cumulative Statistics:
======================================
Computation  Optimization   Objective 
   Time       Iterations   Evaluations
-----------  ------------  -----------
 01:38:03         9            65     
======================================

Rho Estimates (Robust SEs in Parentheses):
===============
  All Groups   
---------------
 +6.688176E-01 
(+1.765532E-03)
===============

Beta Estimates (Robust SEs in Parentheses):
===============
    prices     
---------------
 -6.976445E+00 
(+6.132251E-01)
===============
